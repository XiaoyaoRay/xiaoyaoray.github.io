---
title: 漫画：什么是蓝绿部署？
date: 2019-02-11 15:34:31
categories:
- Kubernetes
tags:
- Kubernetes
---

## 转载：[漫画：什么是蓝绿部署？](http://baijiahao.baidu.com/s?id=1600328572885444668&wfr=spider&for=pc)
![img](http://t11.baidu.com/it/u=1185119041,3482267185&fm=173&app=25&f=JPEG?w=639&h=295&s=F53429731B004C43085171C80000B030)



<!--more-->

![img](http://t10.baidu.com/it/u=3309501702,233977789&fm=173&app=25&f=JPG?w=542&h=386&s=BC28F65A6AEEA44D4C2BCA16020040FF)





![img](http://t11.baidu.com/it/u=140670631,2526599508&fm=173&app=25&f=JPEG?w=639&h=295&s=8414E9330B407C434A7151D800009030)





![img](http://t10.baidu.com/it/u=111965334,4212604057&fm=173&app=25&f=JPEG?w=639&h=295&s=B534693303C04D4B085171C80000B030)





![img](http://t11.baidu.com/it/u=2714158267,1400865281&fm=173&app=25&f=JPEG?w=639&h=295&s=BC047C330B405C47087971D0000090B0)





![img](http://t11.baidu.com/it/u=3563417635,2717878358&fm=173&app=25&f=JPEG?w=639&h=295&s=B57469330B004843085171C80000B030)





![img](http://t11.baidu.com/it/u=2290253758,2614107270&fm=173&app=25&f=JPEG?w=639&h=295&s=9414E9331B1058450A5151D8000090B0)





![img](http://t12.baidu.com/it/u=4097920061,1281282431&fm=173&app=25&f=JPEG?w=639&h=295&s=553429730B804943085171C80000B0B0)





**海豚的秘密**



![img](http://t11.baidu.com/it/u=4014025507,4080207635&fm=173&app=25&f=JPEG?w=640&h=425&s=C9E3924660B3E26760366400030070EA)



大家都知道海豚这种可爱的海洋动物。但又有多少人知道，海豚可以**永远不睡觉**。



是什么样的能力，使得海豚可以永远保持清醒呢？依靠的是海豚大脑特殊的运作方式。



![img](http://t12.baidu.com/it/u=2015436383,1208745932&fm=173&app=25&f=JPG?w=299&h=224&s=91D3A36651BF663F1B0E72400200B0F8)





像人一样，海豚的大脑也分为左脑和右脑两个部分。在海豚活跃的状态下，左脑和右脑都是清醒的：



![img](http://t10.baidu.com/it/u=3184823406,2179256142&fm=173&app=25&f=JPG?w=310&h=284&s=1BE1F70656260719118E5242020030F8)





当然，海豚也是血肉之躯，也是需要休息的。在海豚休息的状态下，其中一半大脑会进入睡眠，另一半大脑仍然保持清醒，以面对各种外界情况。



![img](http://t10.baidu.com/it/u=3965703561,4285226803&fm=173&app=25&f=JPG?w=310&h=284&s=5BA1A54654260719118E5242020030F8)





每隔两个小时，这种一半睡眠一半清醒的状态会进行交替，比如这一刻左脑睡眠右脑清醒，下一刻左脑清醒右脑睡眠。



![img](http://t12.baidu.com/it/u=2624951534,300235967&fm=173&app=25&f=JPG?w=310&h=284&s=1BE1F70654260719118E5242020030F8)





这就是海豚永远不会真正睡觉的秘密。





![img](http://t12.baidu.com/it/u=401383742,4012854581&fm=173&app=25&f=JPEG?w=639&h=295&s=9494E9331B4078430A7111D800009030)





![img](http://t12.baidu.com/it/u=281091857,928013284&fm=173&app=25&f=JPEG?w=639&h=295&s=B53469330BC049430A5131C80000B030)





**什么是蓝绿部署？**



蓝绿部署，英文名**Blue Green Deployment**，是一种可以保证系统在**不间断提供服务**的情况下上线的部署方式。



如何保证系统不间断提供服务呢？



蓝绿部署的模型中包含两个集群，就好比海豚的左脑和右脑。





![img](http://t11.baidu.com/it/u=2581885402,718326796&fm=173&app=25&f=JPG?w=299&h=224&s=99DBA3464BFF661F1B0E72400200B0F8)





在没有上线的正常情况下，集群A和集群B的代码版本是一致的，并且同时对外提供服务。



![img](http://t11.baidu.com/it/u=451588777,585650147&fm=173&app=25&f=JPG?w=313&h=376&s=0B80F5066C667E8C33225B52030070FC)





在系统升级的时候下，我们首先把一个集群（比如集群A）从负载列表中摘除，进行新版本的部署。集群B仍然继续提供服务。



![img](http://t10.baidu.com/it/u=674256450,2530732864&fm=173&app=25&f=JPG?w=308&h=376&s=0BC2E5064C765A8C33423B42030030FC)



当集群A升级完毕，我们把负载均衡重新指向集群A，再把集群B从负载列表中摘除，进行新版本的部署。集群A重新提供服务。



![img](http://t12.baidu.com/it/u=4220945057,1363255956&fm=173&app=25&f=JPG?w=308&h=376&s=0B82F40648776E8C31625B52030030FC)





最后，当集群B也升级完成，我们把集群B也恢复到负载列表当中。这个时候，两个集群的版本都已经升级，并且对外的服务几乎没有间断过。



![img](http://t11.baidu.com/it/u=948049810,2225178196&fm=173&app=25&f=JPG?w=313&h=376&s=0B80F5066C667E8C33225B52030070FC)





![img](http://t10.baidu.com/it/u=2383547481,479382296&fm=173&app=25&f=JPEG?w=639&h=295&s=1C34E1131F4068410A7111D800009030)





![img](http://t12.baidu.com/it/u=1854722465,4125849737&fm=173&app=25&f=JPEG?w=639&h=295&s=B53469331BC0494B085171C80000B0B0)





**什么是滚动部署？**



滚动部署，英文**Rolling update**，同样是一种可以保证系统在**不间断提供服务**的情况下上线的部署方式。



和蓝绿部署不同的是，滚动部署对外提供服务的版本并不是非此即彼，而是在**更细的粒度下平滑完成版本的升级**。



如何做到细粒度平滑升级版本呢？



滚动部署只需要一个集群，集群下的不同节点可以独立进行版本升级。比如在一个16节点的集群中，我们选择每次升级4个节点：





![img](http://t11.baidu.com/it/u=1075546150,1033097315&fm=173&app=25&f=JPG?w=436&h=420&s=0BC6E702E20E4CE96CE85B54030050F4)





![img](http://t11.baidu.com/it/u=2682496597,3429502720&fm=173&app=25&f=JPG?w=436&h=420&s=0B86E702E20E4CE84CE85B54030050F4)





![img](http://t12.baidu.com/it/u=2314143929,1947231498&fm=173&app=25&f=JPG?w=436&h=420&s=0B87E702C20E4CE86CE85B54030050F5)





![img](http://t12.baidu.com/it/u=3281628245,1801032511&fm=173&app=25&f=JPG?w=436&h=420&s=0B87E702C20E4CE86CE85B54030050F4)





以此类推，最终所有的节点都升级了版本。





![img](http://t11.baidu.com/it/u=3294521521,3217467686&fm=173&app=25&f=JPEG?w=639&h=295&s=9414E9331F406D43087151D8000090B0)





![img](http://t10.baidu.com/it/u=3268939599,1217115754&fm=173&app=25&f=JPEG?w=639&h=295&s=B57469331BC04D43085171C80000B030)





![img](http://t11.baidu.com/it/u=57521935,987360313&fm=173&app=25&f=JPEG?w=640&h=322&s=A935CF1005D87DCC1049CDD80300A0B9)







**永生的可能性**





![img](http://t12.baidu.com/it/u=2043248036,3282720952&fm=173&app=25&f=JPEG?w=639&h=295&s=9414E93307407D4B487151D8000090B0)





我们的身体，就仿佛是一个庞大而又复杂的计算机集群，每一个器官相当于集群当中的一个节点，器官和器官之间由无数的神经与血管相连。



![img](http://t10.baidu.com/it/u=2466558006,3450998029&fm=173&app=25&f=JPEG?w=640&h=853&s=353060332B0372CC3DA410E50300F0A3)





对于计算机集群来说，不间断提供服务就是在“活着”。而对于人类来说，**各个器官不间断地运作，维持生命体征**就是在“活着”。



人类的各个器官终究会衰老，那时候也就是人类寿命的终点。如果我们在器官衰老之前，依次把每一个器官都替换成年轻的器官，无论是肝脏还是肾脏，肌肉还是骨骼，这个人能不能永远保持青春呢？



![img](http://t12.baidu.com/it/u=1715810096,1296892583&fm=173&app=25&f=JPEG?w=429&h=242&s=F02BB1545A323E94593AFF9E0300109C)



或许有人会说，人的大脑也是会衰老的，我总不能把大脑也替换掉把？那样我就不再是我了。

但是，人的大脑也并不是独立不可分割的。如果我们把大脑想象成1000个甚至更多个基本单元的集合，每次仅仅替换大脑的千分之一，那么这个人还是这个人，或许连思想意识都几乎不会间断。





![img](http://t11.baidu.com/it/u=680958868,4177061429&fm=173&app=25&f=JPEG?w=639&h=295&s=F534297311D049CA085131C80000B030)



